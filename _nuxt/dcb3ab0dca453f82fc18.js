(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{275:function(t,e,n){var content=n(342);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(10).default)("6ee4cdf3",content,!0,{sourceMap:!1})},341:function(t,e,n){"use strict";var o=n(275);n.n(o).a},342:function(t,e,n){(t.exports=n(9)(!1)).push([t.i,".selected[data-v-6add1f3a]{background:#000;color:#fff}.user-grid[data-v-6add1f3a]{display:grid;grid-auto-flow:column;-webkit-box-pack:start;justify-content:start;overflow-x:scroll;max-width:100vw}",""])},451:function(t,e,n){"use strict";n.r(e);var o={layout:"dashboard-layout",data:function(){return{missionTypeOptions:[{text:"每日",value:0},{text:"系列",value:1}],dialog:!1,innerDialog:!1,headers:[{text:"任務 ID",align:"left",value:"id"},{text:"任務類型",value:"missiontype"},{text:"任務名稱",value:"name"},{text:"任務內容",value:"description",sortable:!1},{text:"積分獎勵",value:"gamepoint",align:"right"},{text:"操作",value:"name",align:"center",sortable:!1}],quests:[],editedIndex:-1,editedItem:{id:0,name:"",description:"",gamepoint:0,missiontype:0},defaultItem:{id:0,name:"",description:"",gamepoint:0,missiontype:0},users:[],selectedUser:{},questUserMap:{}}},computed:{formTitle:function(){return-1===this.editedIndex?"新增":"編輯"}},watch:{dialog:function(t){t||this.close()}},created:function(){this.initialize()},methods:{assignQuest:function(t){var e=this;this.assignQuestToUser(this.selectedUser,t.item).then((function(t){e.initialize()})),t.expanded=!1,this.innerDialog=!1},gamepointOnInput:function(t){this.editedItem.gamepoint=parseInt(t)},initialize:function(){var t=this;this.questUserMap={},this.getQuests().then((function(e){t.quests=e||t.quests})),this.getUsers().then((function(e){t.users=e||t.users,t.users.forEach((function(e){t.getQuestFromUser(e).then((function(n){n.forEach((function(n){t.questUserMap[n.mission]?t.questUserMap[n.mission].push(e):t.questUserMap[n.mission]=[e]}))}))}))}))},editItem:function(t){this.editedIndex=this.quests.indexOf(t),this.editedItem=Object.assign({},t),this.dialog=!0},deleteItem:function(t){var e=this;this.quests.indexOf(t);confirm("Are you sure you want to delete this item?")&&this.deleteQuest(t.id).then((function(t){e.initialize()}))},close:function(){var t=this;this.dialog=!1,setTimeout((function(){t.editedItem=Object.assign({},t.defaultItem),t.editedIndex=-1}),300)},save:function(){var t=this;this.editedIndex>-1?this.updateQuest(this.editedItem).then((function(e){t.initialize()})):this.createQuest(this.editedItem).then((function(e){t.initialize()})),this.close()}}},r=(n(341),n(4)),component=Object(r.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"secret"},[n("v-toolbar",{attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("任務")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("v-dialog",{attrs:{"max-width":"500px"},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[n("v-btn",t._g({staticClass:"mb-2",attrs:{color:"primary",dark:""}},o),[t._v("新增")])]}}]),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t._v(" "),n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v(t._s(t.formTitle))])]),t._v(" "),n("v-card-text",[n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:"",sm12:"",md12:""}},[n("v-text-field",{attrs:{label:"任務名稱"},model:{value:t.editedItem.name,callback:function(e){t.$set(t.editedItem,"name",e)},expression:"editedItem.name"}})],1),t._v(" "),n("v-flex",{attrs:{xs12:"",sm6:"",md6:""}},[n("v-select",{attrs:{items:t.missionTypeOptions},model:{value:t.editedItem.missiontype,callback:function(e){t.$set(t.editedItem,"missiontype",e)},expression:"editedItem.missiontype"}})],1),t._v(" "),n("v-flex",{attrs:{xs12:"",sm6:"",md6:""}},[n("v-text-field",{attrs:{value:t.editedItem.gamepoint,mask:"#########",label:"積分獎勵"},on:{input:t.gamepointOnInput}})],1),t._v(" "),n("v-flex",{attrs:{xs12:"",sm12:"",md12:""}},[n("v-textarea",{attrs:{label:"任務內容"},model:{value:t.editedItem.description,callback:function(e){t.$set(t.editedItem,"description",e)},expression:"editedItem.description"}})],1)],1)],1)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:t.close}},[t._v("取消")]),t._v(" "),n("v-btn",{attrs:{color:"blue darken-1",flat:""},on:{click:t.save}},[t._v("儲存")])],1)],1)],1)],1),t._v(" "),n("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.quests,"rows-per-page-items":[{text:"$vuetify.dataIterator.rowsPerPageAll",value:-1}]},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",{on:{click:function(t){e.expanded=!e.expanded}}},[n("td",[t._v(t._s(e.item.id))]),t._v(" "),n("td",[t._v(t._s(t.missionTypeOptions.find((function(t){return t.value===e.item.missiontype})).text))]),t._v(" "),n("td",[t._v(t._s(e.item.name))]),t._v(" "),n("td",{staticClass:"text-xs-left"},[t._v(t._s(e.item.description))]),t._v(" "),n("td",{staticClass:"text-xs-right"},[t._v(t._s(e.item.gamepoint))]),t._v(" "),n("td",{staticClass:"justify-center align-center layout px-0"},[n("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(n){return n.stopPropagation(),t.editItem(e.item)}}},[t._v("edit")]),t._v(" "),n("v-icon",{attrs:{small:""},on:{click:function(n){return n.stopPropagation(),t.deleteItem(e.item)}}},[t._v("delete")])],1)])]}},{key:"expand",fn:function(e){return[n("div",{staticClass:"user-grid"},t._l(t.questUserMap[e.item.id],(function(e,o){return n("v-card",{key:o},[n("v-card-text",[t._v(t._s(e.id)+" "+t._s(e.nickname))])],1)})),1),t._v(" "),n("v-dialog",{attrs:{"max-width":"500",scrollable:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on;return[n("v-btn",t._g({attrs:{dark:""}},o),[t._v("指定")])]}}],null,!0),model:{value:t.innerDialog,callback:function(e){t.innerDialog=e},expression:"innerDialog"}},[t._v(" "),n("v-card",[n("v-card-text",[n("span",[t._v("指定任務給用戶")])]),t._v(" "),n("v-card-text",[n("v-list",[t._l(t.users,(function(e,o){return[n("v-list-tile",{key:o,class:[t.selectedUser.id===e.id?"selected":""],on:{click:function(n){t.selectedUser=e}}},[n("v-list-tile-content",[n("v-list-tile-title",[t._v(t._s(e.id)+" "+t._s(e.nickname?e.nickname:"--"))])],1)],1),t._v(" "),o+1<t.users.length?n("v-divider",{key:"divider-"+o}):t._e()]}))],2)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{dark:!!t.selectedUser.id,disabled:!t.selectedUser.id},on:{click:function(n){return t.assignQuest(e)}}},[t._v("指派")])],1)],1)],1)]}}])})],1)}),[],!1,null,"6add1f3a",null);e.default=component.exports}}]);